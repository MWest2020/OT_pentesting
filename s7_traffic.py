from snap7 import client, util
import time

# Define PLC connection parameters
plc_ip = "192.168.1.1"  # Replace with the PLC's IP address
rack = 0
slot = 1

# Create a Snap7 client
plc = client.Client()

try:
    # Connect to the PLC
    plc.connect(plc_ip, rack, slot)

    # Define data block details
    data_block_number = 1  # Replace with the desired data block number
    start_address = 0      # Replace with the starting address within the data block
    size = 2              # Replace with the number of bytes to read

    # Perform 200 read operations
    for i in range(200):
        # Read a value from the data block
        data = plc.read_area(0x84, data_block_number, start_address, size)

        # Convert the data to an integer
        value = util.get_int(data, 0)

        # Print the read value
        print(f"Message {i+1}: Read value = {value}")

        # Pause for a short interval (adjust as needed)
        time.sleep(0.1)

finally:
    # Disconnect from the PLC
    plc.disconnect()
